(function () {
    "use strict";
    var pokemonList = {
        "Bulbasaur": "001-00",
        "Ivysaur": "002-00",
        "Venusaur": "003-00",
        "Charmander": "004-00",
        "Charmeleon": "005-00",
        "Charizard": "006-00",
        "Squirtle": "007-00",
        "Wartortle": "008-00",
        "Blastoise": "009-00",
        "Caterpie": "010-00",
        "Metapod": "011-00",
        "Butterfree": "012-00",
        "Weedle": "013-00",
        "Kakuna": "014-00",
        "Beedrill": "015-00",
        "Pidgey": "016-00",
        "Pidgeotto": "017-00",
        "Pidgeot": "018-00",
        "Rattata": "019-00",
        "Raticate": "020-00",
        "Spearow": "021-00",
        "Fearow": "022-00",
        "Ekans": "023-00",
        "Arbok": "024-00",
        "Pikachu": "025-00",
        "Raichu": "026-00",
        "Sandshrew": "027-00",
        "Sandslash": "028-00",
        "Nidoran&#x2640;": "029-00",
        "Nidorina": "030-00",
        "Nidoqueen": "031-00",
        "Nidoran&#x2642;": "032-00",
        "Nidorino": "033-00",
        "Nidoking": "034-00",
        "Clefairy": "035-00",
        "Clefable": "036-00",
        "Vulpix": "037-00",
        "Ninetales": "038-00",
        "Jigglypuff": "039-00",
        "Wigglytuff": "040-00",
        "Zubat": "041-00",
        "Golbat": "042-00",
        "Oddish": "043-00",
        "Gloom": "044-00",
        "Vileplume": "045-00",
        "Paras": "046-00",
        "Parasect": "047-00",
        "Venonat": "048-00",
        "Venomoth": "049-00",
        "Diglett": "050-00",
        "Dugtrio": "051-00",
        "Meowth": "052-00",
        "Persian": "053-00",
        "Psyduck": "054-00",
        "Golduck": "055-00",
        "Mankey": "056-00",
        "Primeape": "057-00",
        "Growlithe": "058-00",
        "Arcanine": "059-00",
        "Poliwag": "060-00",
        "Poliwhirl": "061-00",
        "Poliwrath": "062-00",
        "Abra": "063-00",
        "Kadabra": "064-00",
        "Alakazam": "065-00",
        "Machop": "066-00",
        "Machoke": "067-00",
        "Machamp": "068-00",
        "Bellsprout": "069-00",
        "Weepinbell": "070-00",
        "Victreebel": "071-00",
        "Tentacool": "072-00",
        "Tentacruel": "073-00",
        "Geodude": "074-00",
        "Graveler": "075-00",
        "Golem": "076-00",
        "Ponyta": "077-00",
        "Rapidash": "078-00",
        "Slowpoke": "079-00",
        "Slowbro": "080-00",
        "Magnemite": "081-00",
        "Magneton": "082-00",
        "Farfetch'd": "083-00",
        "Doduo": "084-00",
        "Dodrio": "085-00",
        "Seel": "086-00",
        "Dewgong": "087-00",
        "Grimer": "088-00",
        "Muk": "089-00",
        "Shellder": "090-00",
        "Cloyster": "091-00",
        "Gastly": "092-00",
        "Haunter": "093-00",
        "Gengar": "094-00",
        "Onix": "095-00",
        "Drowzee": "096-00",
        "Hypno": "097-00",
        "Krabby": "098-00",
        "Kingler": "099-00",
        "Voltorb": "100-00",
        "Electrode": "101-00",
        "Exeggcute": "102-00",
        "Exeggutor": "103-00",
        "Cubone": "104-00",
        "Marowak": "105-00",
        "Hitmonlee": "106-00",
        "Hitmonchan": "107-00",
        "Lickitung": "108-00",
        "Koffing": "109-00",
        "Weezing": "110-00",
        "Rhyhorn": "111-00",
        "Rhydon": "112-00",
        "Chansey": "113-00",
        "Tangela": "114-00",
        "Kangaskhan": "115-00",
        "Horsea": "116-00",
        "Seadra": "117-00",
        "Goldeen": "118-00",
        "Seaking": "119-00",
        "Staryu": "120-00",
        "Starmie": "121-00",
        "Mr. Mime": "122-00",
        "Scyther": "123-00",
        "Jynx": "124-00",
        "Electabuzz": "125-00",
        "Magmar": "126-00",
        "Pinsir": "127-00",
        "Tauros": "128-00",
        "Magikarp": "129-00",
        "Gyarados": "130-00",
        "Lapras": "131-00",
        "Ditto": "132-00",
        "Eevee": "133-00",
        "Vaporeon": "134-00",
        "Jolteon": "135-00",
        "Flareon": "136-00",
        "Porygon": "137-00",
        "Omanyte": "138-00",
        "Omastar": "139-00",
        "Kabuto": "140-00",
        "Kabutops": "141-00",
        "Aerodactyl": "142-00",
        "Snorlax": "143-00",
        "Articuno": "144-00",
        "Zapdos": "145-00",
        "Moltres": "146-00",
        "Dratini": "147-00",
        "Dragonair": "148-00",
        "Dragonite": "149-00",
        "Mewtwo": "150-00",
        "Mew": "151-00",
        "Chikorita": "152-00",
        "Bayleef": "153-00",
        "Meganium": "154-00",
        "Cyndaquil": "155-00",
        "Quilava": "156-00",
        "Typhlosion": "157-00",
        "Totodile": "158-00",
        "Croconaw": "159-00",
        "Feraligatr": "160-00",
        "Sentret": "161-00",
        "Furret": "162-00",
        "Hoothoot": "163-00",
        "Noctowl": "164-00",
        "Ledyba": "165-00",
        "Ledian": "166-00",
        "Spinarak": "167-00",
        "Ariados": "168-00",
        "Crobat": "169-00",
        "Chinchou": "170-00",
        "Lanturn": "171-00",
        "Pichu": "172-00",
        "Cleffa": "173-00",
        "Igglybuff": "174-00",
        "Togepi": "175-00",
        "Togetic": "176-00",
        "Natu": "177-00",
        "Xatu": "178-00",
        "Mareep": "179-00",
        "Flaaffy": "180-00",
        "Ampharos": "181-00",
        "Bellossom": "182-00",
        "Marill": "183-00",
        "Azumarill": "184-00",
        "Sudowoodo": "185-00",
        "Politoed": "186-00",
        "Hoppip": "187-00",
        "Skiploom": "188-00",
        "Jumpluff": "189-00",
        "Aipom": "190-00",
        "Sunkern": "191-00",
        "Sunflora": "192-00",
        "Yanma": "193-00",
        "Wooper": "194-00",
        "Quagsire": "195-00",
        "Espeon": "196-00",
        "Umbreon": "197-00",
        "Murkrow": "198-00",
        "Slowking": "199-00",
        "Misdreavus": "200-00",
        "Unown": "201-00",
        "Wobbuffet": "202-00",
        "Girafarig": "203-00",
        "Pineco": "204-00",
        "Forretress": "205-00",
        "Dunsparce": "206-00",
        "Gligar": "207-00",
        "Steelix": "208-00",
        "Snubbull": "209-00",
        "Granbull": "210-00",
        "Qwilfish": "211-00",
        "Scizor": "212-00",
        "Shuckle": "213-00",
        "Heracross": "214-00",
        "Sneasel": "215-00",
        "Teddiursa": "216-00",
        "Ursaring": "217-00",
        "Slugma": "218-00",
        "Magcargo": "219-00",
        "Swinub": "220-00",
        "Piloswine": "221-00",
        "Corsola": "222-00",
        "Remoraid": "223-00",
        "Octillery": "224-00",
        "Delibird": "225-00",
        "Mantine": "226-00",
        "Skarmory": "227-00",
        "Houndour": "228-00",
        "Houndoom": "229-00",
        "Kingdra": "230-00",
        "Phanpy": "231-00",
        "Donphan": "232-00",
        "Porygon2": "233-00",
        "Stantler": "234-00",
        "Smeargle": "235-00",
        "Tyrogue": "236-00",
        "Hitmontop": "237-00",
        "Smoochum": "238-00",
        "Elekid": "239-00",
        "Magby": "240-00",
        "Miltank": "241-00",
        "Blissey": "242-00",
        "Raikou": "243-00",
        "Entei": "244-00",
        "Suicune": "245-00",
        "Larvitar": "246-00",
        "Pupitar": "247-00",
        "Tyranitar": "248-00",
        "Lugia": "249-00",
        "Ho-Oh": "250-00",
        "Celebi": "251-00",
        "Treecko": "252-00",
        "Grovyle": "253-00",
        "Sceptile": "254-00",
        "Torchic": "255-00",
        "Combusken": "256-00",
        "Blaziken": "257-00",
        "Mudkip": "258-00",
        "Marshtomp": "259-00",
        "Swampert": "260-00",
        "Poochyena": "261-00",
        "Mightyena": "262-00",
        "Zigzagoon": "263-00",
        "Linoone": "264-00",
        "Wurmple": "265-00",
        "Silcoon": "266-00",
        "Beautifly": "267-00",
        "Cascoon": "268-00",
        "Dustox": "269-00",
        "Lotad": "270-00",
        "Lombre": "271-00",
        "Ludicolo": "272-00",
        "Seedot": "273-00",
        "Nuzleaf": "274-00",
        "Shiftry": "275-00",
        "Taillow": "276-00",
        "Swellow": "277-00",
        "Wingull": "278-00",
        "Pelipper": "279-00",
        "Ralts": "280-00",
        "Kirlia": "281-00",
        "Gardevoir": "282-00",
        "Surskit": "283-00",
        "Masquerain": "284-00",
        "Shroomish": "285-00",
        "Breloom": "286-00",
        "Slakoth": "287-00",
        "Vigoroth": "288-00",
        "Slaking": "289-00",
        "Nincada": "290-00",
        "Ninjask": "291-00",
        "Shedinja": "292-00",
        "Whismur": "293-00",
        "Loudred": "294-00",
        "Exploud": "295-00",
        "Makuhita": "296-00",
        "Hariyama": "297-00",
        "Azurill": "298-00",
        "Nosepass": "299-00",
        "Skitty": "300-00",
        "Delcatty": "301-00",
        "Sableye": "302-00",
        "Mawile": "303-00",
        "Aron": "304-00",
        "Lairon": "305-00",
        "Aggron": "306-00",
        "Meditite": "307-00",
        "Medicham": "308-00",
        "Electrike": "309-00",
        "Manectric": "310-00",
        "Plusle": "311-00",
        "Minun": "312-00",
        "Volbeat": "313-00",
        "Illumise": "314-00",
        "Roselia": "315-00",
        "Gulpin": "316-00",
        "Swalot": "317-00",
        "Carvanha": "318-00",
        "Sharpedo": "319-00",
        "Wailmer": "320-00",
        "Wailord": "321-00",
        "Numel": "322-00",
        "Camerupt": "323-00",
        "Torkoal": "324-00",
        "Spoink": "325-00",
        "Grumpig": "326-00",
        "Spinda": "327-00",
        "Trapinch": "328-00",
        "Vibrava": "329-00",
        "Flygon": "330-00",
        "Cacnea": "331-00",
        "Cacturne": "332-00",
        "Swablu": "333-00",
        "Altaria": "334-00",
        "Zangoose": "335-00",
        "Seviper": "336-00",
        "Lunatone": "337-00",
        "Solrock": "338-00",
        "Barboach": "339-00",
        "Whiscash": "340-00",
        "Corphish": "341-00",
        "Crawdaunt": "342-00",
        "Baltoy": "343-00",
        "Claydol": "344-00",
        "Lileep": "345-00",
        "Cradily": "346-00",
        "Anorith": "347-00",
        "Armaldo": "348-00",
        "Feebas": "349-00",
        "Milotic": "350-00",
        "Castform": "351-00",
        "Kecleon": "352-00",
        "Shuppet": "353-00",
        "Banette": "354-00",
        "Duskull": "355-00",
        "Dusclops": "356-00",
        "Tropius": "357-00",
        "Chimecho": "358-00",
        "Absol": "359-00",
        "Wynaut": "360-00",
        "Snorunt": "361-00",
        "Glalie": "362-00",
        "Spheal": "363-00",
        "Sealeo": "364-00",
        "Walrein": "365-00",
        "Clamperl": "366-00",
        "Huntail": "367-00",
        "Gorebyss": "368-00",
        "Relicanth": "369-00",
        "Luvdisc": "370-00",
        "Bagon": "371-00",
        "Shelgon": "372-00",
        "Salamence": "373-00",
        "Beldum": "374-00",
        "Metang": "375-00",
        "Metagross": "376-00",
        "Regirock": "377-00",
        "Regice": "378-00",
        "Registeel": "379-00",
        "Latias": "380-00",
        "Latios": "381-00",
        "Kyogre": "382-00",
        "Groudon": "383-00",
        "Rayquaza": "384-00",
        "Jirachi": "385-00",
        "Deoxys": "386-00",
        "Turtwig": "387-00",
        "Grotle": "388-00",
        "Torterra": "389-00",
        "Chimchar": "390-00",
        "Monferno": "391-00",
        "Infernape": "392-00",
        "Piplup": "393-00",
        "Prinplup": "394-00",
        "Empoleon": "395-00",
        "Starly": "396-00",
        "Staravia": "397-00",
        "Staraptor": "398-00",
        "Bidoof": "399-00",
        "Bibarel": "400-00",
        "Kricketot": "401-00",
        "Kricketune": "402-00",
        "Shinx": "403-00",
        "Luxio": "404-00",
        "Luxray": "405-00",
        "Budew": "406-00",
        "Roserade": "407-00",
        "Cranidos": "408-00",
        "Rampardos": "409-00",
        "Shieldon": "410-00",
        "Bastiodon": "411-00",
        "Burmy": "412-00",
        "Wormadam": "413-00",
        "Mothim": "414-00",
        "Combee": "415-00",
        "Vespiquen": "416-00",
        "Pachirisu": "417-00",
        "Buizel": "418-00",
        "Floatzel": "419-00",
        "Cherubi": "420-00",
        "Cherrim": "421-00",
        "Shellos": "422-00",
        "Gastrodon": "423-00",
        "Ambipom": "424-00",
        "Drifloon": "425-00",
        "Drifblim": "426-00",
        "Buneary": "427-00",
        "Lopunny": "428-00",
        "Mismagius": "429-00",
        "Honchkrow": "430-00",
        "Glameow": "431-00",
        "Purugly": "432-00",
        "Chingling": "433-00",
        "Stunky": "434-00",
        "Skuntank": "435-00",
        "Bronzor": "436-00",
        "Bronzong": "437-00",
        "Bonsly": "438-00",
        "Mime Jr.": "439-00",
        "Happiny": "440-00",
        "Chatot": "441-00",
        "Spiritomb": "442-00",
        "Gible": "443-00",
        "Gabite": "444-00",
        "Garchomp": "445-00",
        "Munchlax": "446-00",
        "Riolu": "447-00",
        "Lucario": "448-00",
        "Hippopotas": "449-00",
        "Hippowdon": "450-00",
        "Skorupi": "451-00",
        "Drapion": "452-00",
        "Croagunk": "453-00",
        "Toxicroak": "454-00",
        "Carnivine": "455-00",
        "Finneon": "456-00",
        "Lumineon": "457-00",
        "Mantyke": "458-00",
        "Snover": "459-00",
        "Abomasnow": "460-00",
        "Weavile": "461-00",
        "Magnezone": "462-00",
        "Lickilicky": "463-00",
        "Rhyperior": "464-00",
        "Tangrowth": "465-00",
        "Electivire": "466-00",
        "Magmortar": "467-00",
        "Togekiss": "468-00",
        "Yanmega": "469-00",
        "Leafeon": "470-00",
        "Glaceon": "471-00",
        "Gliscor": "472-00",
        "Mamoswine": "473-00",
        "Porygon-Z": "474-00",
        "Gallade": "475-00",
        "Probopass": "476-00",
        "Dusknoir": "477-00",
        "Froslass": "478-00",
        "Rotom": "479-00",
        "Uxie": "480-00",
        "Mesprit": "481-00",
        "Azelf": "482-00",
        "Dialga": "483-00",
        "Palkia": "484-00",
        "Heatran": "485-00",
        "Regigigas": "486-00",
        "Giratina": "487-00",
        "Cresselia": "488-00",
        "Phione": "489-00",
        "Manaphy": "490-00",
        "Darkrai": "491-00",
        "Shaymin": "492-00",
        "Arceus": "493-00",
        "Meltan": "808-00",
        "Melmetal": "809-00",
        "Rattata (Alola Form)": "019-61",
        "Raticate (Alola Form)": "020-61",
        "Raichu (Alola Form)": "026-61",
        "Sandshrew (Alola Form)": "027-61",
        "Sandslash (Alola Form)": "028-61",
        "Vulpix (Alola Form)": "037-61",
        "Ninetales (Alola Form)": "038-61",
        "Diglett (Alola Form)": "050-61",
        "Dugtrio (Alola Form)": "051-61",
        "Meowth (Alola Form)": "052-61",
        "Persian (Alola Form)": "053-61",
        "Geodude (Alola Form)": "074-61",
        "Graveler (Alola Form)": "075-61",
        "Golem (Alola Form)": "076-61",
        "Grimer (Alola Form)": "088-61",
        "Muk (Alola Form)": "089-61"
    }
    let socket = io.connect("/", {
            forceNew: true
        }),
        userData = {};
    Object.keys(pokemonList).forEach(item => {
        let pokemonName = document.createElement("option");
        pokemonName.setAttribute("value", item);
        pokemonName.setAttribute("img-value", pokemonList[item])
        document.querySelector("#pokemonsNames").appendChild(pokemonName)
    })

    document.body.classList.add("showModal");
    if(localStorage && localStorage.getItem("username")){
        document.getElementsByClassName("username")[0].value = localStorage.getItem("username");
    }

    socket.on("updateUserList", data => {
        var usersCounter = 0;
        document.querySelector(".usersList").innerHTML = "<option value='' hidden>Select a player</option>";
        data.forEach(username => {
            if (userData.username != username && username.match(/_guest\d{8}/g) == null) {
                let newUserDom = document.createElement("option");
                newUserDom.textContent = username;
                newUserDom.value = username;
                document.querySelector(".usersList").appendChild(newUserDom);
                usersCounter++;
            }
        })
        document.querySelector(".usersCount").innerHTML = data.length;
    })

    socket.on("displayPokemonTypes", data => {
        document.querySelector(".showRandomTypes").innerHTML = "";
        data.forEach(function (type) {
            var liItem = document.createElement("li");
            liItem.classList.add("randomType");
            var divItem = document.createElement("div");
            divItem.classList.add("ico-type", type.toLowerCase());
            liItem.appendChild(divItem);
            document.querySelector(".showRandomTypes").append(liItem);
        })
    })

    socket.on("confirmChallenge", response => {
        userData.challengeResponse = confirm(response.message);
        if (userData.challengeResponse) {
            userData.rival = response.rival;
            userData.role = "visitor";
        }
        socket.emit("challengeResponse", userData);
    })
    /*buttons*/
    document.querySelector("#login").addEventListener("click", function () {
        document.body.classList.remove("showModal");
        document.body.classList.add("hideModal");
        userData.username = document.querySelector(".username").value;
        if(localStorage){localStorage.setItem("username", userData.username)}
        socket.emit("newUser", userData);
    })
    document.querySelector("#guestBtn").addEventListener("click", function () {
        document.body.classList.remove("showModal");
        document.body.classList.add("hideModal");
        userData.username = "_guest" + Date.now();
        socket.emit("newUser", userData);
    })
    document.querySelectorAll("[name='typeAmmount']").forEach(function (item) {
        item.addEventListener("click", function () {
            if (this.value == 3) {
                document.getElementById("enableRepeatedRandoms").disabled = false;
            } else {
                document.getElementById("enableRepeatedRandoms").disabled = true;
                document.getElementById("enableRepeatedRandoms").checked = false;
            }
        })
    })
    document.querySelector(".randomChooseBtn").addEventListener("click", function () {
        var typesAmmount = document.querySelector("[name='typeAmmount']:checked").value;
        var repeatTypes = document.getElementById("enableRepeatedRandoms").checked;
        socket.emit("requestRandomPokemons", {
            userData: userData,
            ammount: typesAmmount,
            repeat: repeatTypes
        });
    })

    document.querySelector(".challengeUser").addEventListener("click", function () {
        let selectedUser = document.querySelector(".usersList").selectedOptions[0].value;
        userData.rival = selectedUser;
        if(userData.username){
            socket.emit("challengeUser", userData);
        }else{
            alert("You need to login to challenge someone!")
        }
    })

    let loadPokemonImage = function () {
        if (!pokemonList[this.value]) {
            this.parentElement.querySelector(".pokeImg").setAttribute("src", "");
        } else {
            this.parentElement.querySelector(".pokeImg").setAttribute("src", "https://pokemon.gameinfo.io/images/pokemon-go/thumbs/60/" + pokemonList[this.value] + ".webp");
        }
    }

    document.querySelectorAll(".pokemonName").forEach(item => {
        item.addEventListener("blur", loadPokemonImage)
        item.addEventListener("keyup", loadPokemonImage)
    })
})()
